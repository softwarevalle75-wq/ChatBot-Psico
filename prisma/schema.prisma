generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//Creacion usuario:-----------------------------------------------------------------------------------------------------------------------------------------------------
model informacionUsuario {
  idUsuario               String    @id @default(cuid())
  primerNombre            String
  segundoNombre           String?
  primerApellido          String
  segundoApellido         String?
  telefonoPersonal        String    @unique
  segundoTelefono         String?
  correo                  String    @unique
  segundoCorreo           String?
  fechaNacimiento         DateTime
  perteneceUniversidad    String   @default("No") 
  semestre                String?
  jornada                 String?
  carrera                 String?
  password                String
  consentimientoInformado String   @default("No") 
  autorizacionDatos       String   @default("No") 
  ayudaPsicologica        String?
  flujo                   String?
  historial               Json?
  testActual              String?
  fechaCreacion           DateTime  @default(now())
  fechaActualizacion      DateTime  @updatedAt
  
  // Relación con información sociodemográfica
  informacionSociodemografica InformacionSociodemografica?

  // Relación con ghq12
  ghq12  ghq12?
  tests  tests?
  dass21 dass21?

  // Agendamiento
  citas         cita[]
  registroCitas registroCitas[]

  // Historial de pruebas
  historialTests HistorialTest[]
}

//Modelo Historial pruebas usuario
model HistorialTest {
  id                Int @id @default(autoincrement())
  usuario           informacionUsuario @relation(fields: [usuarioId], references: [idUsuario])
  usuarioId         String
  tipoTest          String
  fechaCompletado   DateTime @default(now())
  resultados        Json

  @@index([usuarioId]) // Indice para optimizar busquedas por usuario
}

//----------------------------------------------------------------------------------------------------------------------------------------------------------------------

//GHQ12 + DASS21 + Tests:
model ghq12 {
  idGhq12        String @id @unique @default(uuid())
  telefono       String @unique
  historial      Json?
  Puntaje        Int    @default(0)
  preguntaActual Int    @default(0)
  resPreg        Json?

  usuario informacionUsuario @relation(fields: [telefono], references: [telefonoPersonal]) // Relación con informacionUsuario
}

model dass21 {
  idDass21       String @id @unique @default(uuid())
  telefono       String @unique
  historial      Json?
  puntajeDep Int    @default(0)
  puntajeAns Int    @default(0)
  puntajeEstr Int    @default(0)
  preguntaActual Int    @default(0)
  resPreg        Json?
  respuestas     Json?

  usuario informacionUsuario @relation(fields: [telefono], references: [telefonoPersonal])
}

model tests {
  idTests        String @id @unique @default(uuid())
  telefono       String @unique
  tratDatos      String @default("")
  historial      Json?
  Puntaje        Int    @default(0)
  preguntaActual Int    @default(0)
  resPreg        Json?

  usuario informacionUsuario @relation(fields: [telefono], references: [telefonoPersonal]) // Relación con informacionUsuario
}

//----------------------------------------------------------------------------------------------------------------------------------------------------------------------

//Agendamientos:

model consultorio {
  idConsultorio String   @id @unique @default(uuid())
  nombre        String
  activo        Boolean  @default(true)
  fechaCreacion DateTime @default(now())

  citas         cita[] // Relación con cita
  registroCitas registroCitas[]
}

model practicante {
  idPracticante    String   @id @unique @default(uuid())
  numero_documento String   @unique
  tipo_documento   String   @default("CC")
  nombre           String
  genero           String
  estrato          String
  barrio           String
  localidad        String
  sesiones         Int      @default(0)
  fechaCreacion    DateTime @default(now())
  telefono         String  @unique

  citas         cita[] // Relación con cita
  registroCitas registroCitas[]

  horarios Horario[]
}

model Horario {
  id            String      @id @default(uuid())
  dia           DiaSemana
  horaInicio    Int
  horaFin       Int

  practicante   practicante @relation(fields: [practicanteId], references: [idPracticante])
  practicanteId String
}

enum DiaSemana {
  LUNES
  MARTES
  MIERCOLES
  JUEVES
  VIERNES
  SABADO
  DOMINGO
}

enum Rol {
  usuario
  practicante
  admin
}

//----------------------------------------------------------------------------------------------------------------------------------------

model rolChat {
  telefono   String   @id @unique
  rol        Rol      @default(usuario)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model cita {
  idCita        String   @id @unique @default(uuid())
  idConsultorio String
  idUsuario     String
  idPracticante String
  fechaHora     DateTime
  estado        String   @default("pendiente")
  fechaCreacion DateTime @default(now())

  consultorio consultorio        @relation(fields: [idConsultorio], references: [idConsultorio]) // Relación con consultorio
  usuario     informacionUsuario @relation(fields: [idUsuario], references: [idUsuario]) // Relación con informacionUsuario
  practicante practicante        @relation(fields: [idPracticante], references: [idPracticante]) // Relación con practicante
}

model registroCitas {
  idCita        String   @id @unique @default(uuid())
  idConsultorio String
  idUsuario     String
  idPracticante String
  fechaHora     DateTime
  estado        String   @default("pendiente")
  fechaCreacion DateTime @default(now())

  consultorio consultorio        @relation(fields: [idConsultorio], references: [idConsultorio]) // Relación con consultorio
  usuario     informacionUsuario @relation(fields: [idUsuario], references: [idUsuario]) // Relación con informacionUsuario
  practicante practicante        @relation(fields: [idPracticante], references: [idPracticante]) // Relación con practicante
}

//----------------------------------------------------------------------------------------------------------------------------------------------------------------------

// Información Sociodemográfica
model InformacionSociodemografica {
  id                    String @id @default(cuid())
  usuarioId             String @unique
  estadoCivil           EstadoCivil
  numeroHijos           Int @default(0)
  numeroHermanos        Int @default(0)
  conQuienVive          String
  tienePersonasACargo   String @default("Si")
  rolFamiliar           RolFamiliar
  escolaridad           Escolaridad
  ocupacion             String
  nivelIngresos         NivelIngresos
  fechaCreacion         DateTime @default(now())
  fechaActualizacion    DateTime @updatedAt
  
  // Relación con usuario
  usuario               informacionUsuario @relation(fields: [usuarioId], references: [idUsuario], onDelete: Cascade)
  
  @@map("informacion_sociodemografica")
}

enum EstadoCivil {
  soltero
  casado
  union_libre
  divorciado
  viudo
  separado
}

enum RolFamiliar {
  madre
  padre
  hijo
  hermano
  abuelo
  nieto
  tio
  sobrino
  otro
}

enum Escolaridad {
  primaria_incompleta
  primaria_completa
  secundaria_incompleta
  secundaria_completa
  tecnico_incompleto
  tecnico_completo
  universitario_incompleto
  universitario_completo
  posgrado_incompleto
  posgrado_completo
}

enum NivelIngresos {
  nivel_0_1_smmlv
  nivel_1_2_smmlv
  nivel_2_3_smmlv
  nivel_3_4_smmlv
  mayor_4_smmlv
}
